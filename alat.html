<!DOCTYPE html>
<html lang="sr-Latn">
<head>
    <meta charset="UTF-8">
    <title>Interni Alat - PDF Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.7.0/mammoth.browser.min.js"></script>
    <style>
        :root {
            --primary-color: #007aff;
            --text-color: #1d1d1f;
            --background-color: #f5f5f7;
            --border-color: #d2d2d7;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--background-color);
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .container {
            max-width: 600px;
            width: 100%;
            background: #fff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
        }
        /* Stilovi za login formu */
        #login-form input {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }
        #login-form button {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        #error-message {
            color: #dc3545;
            margin-top: 10px;
            min-height: 20px;
        }
        /* Stilovi za alat, sakriven po defaultu */
        #tool-content {
            display: none;
        }
        .file-upload-wrapper {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 40px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .file-upload-wrapper:hover {
            background-color: #fafafa;
            border-color: var(--primary-color);
        }
        #status {
            margin-top: 20px;
            font-weight: 500;
            min-height: 20px;
        }
        #file-input {
            display: none;
        }
        #pdf-content-source {
            display: none;
            font-family: 'Times New Roman', Times, serif;
            font-size: 12pt;
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="login-container">
            <h1>Pristup Alatu</h1>
            <form id="login-form" onsubmit="handleLogin(event)">
                <input type="text" id="username" placeholder="Korisničko ime" required>
                <input type="password" id="password" placeholder="Lozinka" required>
                <button type="submit">Prijavi se</button>
                <div id="error-message"></div>
            </form>
        </div>

        <div id="tool-content">
            <h1>ugovor24.com PDF Generator</h1>
            <input type="file" id="file-input" accept=".docx" onchange="handleFileSelect(event)">
            <label for="file-input" class="file-upload-wrapper">
                <p>Klikni ovdje da izabereš .docx fajl</p>
            </label>
            <div id="status"></div>
        </div>
    </div>

    <div id="pdf-content-source"></div>

    <script>
        const { jsPDF } = window.jspdf;

        function handleLogin(event) {
            event.preventDefault();
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            const errorDiv = document.getElementById('error-message');

            // UPOZORENJE: Ovo je nesigurna metoda provjere.
            if (user === 'dex' && pass === 'sasa76') {
                document.getElementById('login-container').style.display = 'none';
                document.getElementById('tool-content').style.display = 'block';
            } else {
                errorDiv.innerText = 'Pogrešni kredencijali.';
            }
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            const statusDiv = document.getElementById('status');
            statusDiv.innerText = '';

            if (!file) return;

            if (!file.name.endsWith('.docx')) {
                statusDiv.innerText = 'Greška: Molimo izaberite .docx fajl.';
                return;
            }

            statusDiv.innerText = `Fajl "${file.name}" se obrađuje...`;
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    const arrayBuffer = e.target.result;
                    const result = await mammoth.convertToHtml({ arrayBuffer });
                    await generatePdf(result.value, file.name.replace('.docx', '.pdf'));
                    statusDiv.innerText = `PDF je uspješno generisan i preuzet!`;
                } catch (err) {
                    console.error("Greška pri konverziji:", err);
                    statusDiv.innerText = 'Greška pri čitanju DOCX fajla. Fajl je možda oštećen.';
                }
            };
            reader.readAsArrayBuffer(file);
        }

        async function generatePdf(htmlContent, fileName) {
            const source = document.getElementById('pdf-content-source');
            source.innerHTML = htmlContent;
            
            const doc = new jsPDF({ unit: 'mm', format: 'a4' });
            doc.setFont('Times', 'normal');

            await doc.html(source, {
                callback: function(doc) {
                    const totalPages = doc.internal.getNumberOfPages();
                    for (let i = 1; i <= totalPages; i++) {
                        doc.setPage(i);
                        const pageWidth = doc.internal.pageSize.getWidth();
                        const pageHeight = doc.internal.pageSize.getHeight();
                        
                        // Heder
                        const headerY = 18;
                        doc.setFont('Helvetica', 'bold');
                        doc.setTextColor('#1d1d1f');
                        doc.text('ugovor', pageWidth - 47, headerY);
                        doc.setTextColor('#007aff');
                        doc.text('24', pageWidth - 30, headerY);
                        doc.setTextColor('#1d1d1f');
                        doc.text('.com', pageWidth - 23, headerY);
                        doc.setDrawColor('#007aff');
                        doc.setLineWidth(0.5);
                        doc.line(20, headerY + 3, pageWidth - 20, headerY + 3);

                        // Futer
                        const footerY = pageHeight - 15;
                        doc.setFont('Helvetica', 'normal');
                        doc.setFontSize(10);
                        doc.setTextColor('#6e6e73');
                        doc.text('advokat@ugovor24.com', 20, footerY);
                        const pageNumText = `Stranica ${i} / ${totalPages}`;
                        const pageNumWidth = doc.getStringUnitWidth(pageNumText) * doc.getFontSize() / doc.internal.scaleFactor;
                        doc.text(pageNumText, pageWidth - 20 - pageNumWidth, footerY);
                    }
                    doc.save(fileName);
                },
                x: 20,
                y: 35,
                width: 170,
                windowWidth: 650,
            });
        }
    </script>

</body>
</html>
